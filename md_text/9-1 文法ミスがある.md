# 文法ミスがある
HTMLには決まった文法があり、仕様として公開されています。仕様に沿わないHTMLは、適切に処理されない場合があります。文法チェックのプロセスを整備して、漏れなく確実に文法チェックを行うようにしましょう。

## よく見られる問題

### 開始タグと終了タグが対応していない
<label for="name1">氏名</label> <input id="name1"/>
<label for="name1">ニックネーム</label> <input id="name1"/>

終了タグの抜けや、タイプミスがある例。タグの対応関係が正しくなくなると、ユーザーエージェントが適切に解釈できなくなる。

### 他の要素と同じIDがついている
<label for="name1">氏名</label>
<input id="name1"/>
<label for="name1">ニックネーム</label>
<input id="name1"/>

同じIDが複数指定されている例。一見問題なく見えるが、ラベルが正しく機能しないなどの問題が起きる。


## ここが問題！ 文法ミスはさまざまなトラブルを招く
文法ミスはさまざまなトラブルを招くことがあります。一見問題なくても、支援技術やクローラーでは正しく扱えないというケースもあります。文法ミスにはさまざまなケースがあります。

### 開始タグと終了タグが対応していない
典型的な文法ミスは、開始タグや終了タグの抜けと、スペルミスです。ミスによって表示が崩れることもありますが、div要素の終了タグの抜けなど、気づきにくいものもあります。表示が崩れなかったとしても機械でうまく処理できなくなることがあり、マシンリーダビリティを低下させます。

### 他の要素と同じIDがついている
id属性で要素のIDを指定しますが、ひとつのHTMLで同じIDを複数使うことはできません。意外に気づきにくく、誤動作などの厄介なトラブルにつながることもあります。たとえば、label要素とコントロールの関連づけにIDを使っている場合、複数の要素に同一のIDがついていると、ラベルを適切に関連づけられず、スクリーンリーダーでの利用に支障が出ることがあります。

コンポーネントのHTMLにも注意が必要です。コンポーネントに特定のid属性をつける必要がある場合、そのコンポーネントはページ内で一度しか使えなくなります。コンポーネントが同じページ内で繰り返し使われる可能性がある場合、id属性を使ってスタイルを定義するべきではありません。

また、書かれているHTMLそのものに問題がなくても、JavaScriptで挿入されたHTMLにIDがついていて、この問題が起きるケースもあります。


### 未知の要素名や属性名が使用されている
HTML5では、未知の要素や属性を使用しても、大きなトラブルに結びつくことはありません。しかし、チェックツールで未知要素が警告されるケースは、本来の要素名や属性名のスペルミスであることが多く、その場合には本来あるべき要素や属性が漏れていることになります。他にも、必須の属性の指定が漏れている、属性値として指定できない値が指定されているなど、さまざまなミスのパターンがあります。


## 解決アプローチの例
### HTMLを書かないようにする
コンポーネントを組み合わせるタイプのCMSの例。CMSを活用し、HTMLを書かずにコンテンツを作成すれば文法ミスは起こらない。

### オーサリングツールを活用する
オーサリングツールの入力補完機能の例。オーサリングツールを活用することで、文法ミスをなくしたり、減らしたりすることができる。

### 文法チェックを行う
文法チェックツールの例。文法ミスがないかどうかは機械的にチェックすることができる。


## 解決アプローチHTMLを書かない、書いたら確実に文法チェック
HTMLを書かなければ、文法ミスは起こりません。運用時は人間がHTMLを都度書くのではなく、CMSで機械的に処理することが望ましいでしょう。人間がHTMLを書く場合は、文法チェックを漏れなく確実に行うためのプロセスの整備が重要になります。

### HTMLを書かないようにする
人間がHTMLを書かなければ、文法ミスは起こりません。コンテンツの作成や運用の際、HTMLを書かないようにする方法もあります。あらかじめ用意されたパーツを組み合わせ、テキストなどを入力するだけでコンテンツができる仕組みを用意すれば、HTMLを書くことは必須ではなくなります。

CMSの中には、HTMLを書かずに運用できる製品もあります。運用者がコンポーネントを選んだり、画像やテキストを入れたりするだけでコンテンツを作れるなら、文法ミスをなくすことができるでしょう。CMSの選定については「3-6 CMSの導入で失敗する」も参考にしてください。

### オーサリングツールを活用する
運用時にはCMSを活用できますが、サイトの構築時には何らかの形でHTMLを書く必要があります。人間がHTMLを書いて作業する以上、ミスを完全になくすことはできません。しかし減らすことはできます。

ミスを減らす方法のひとつは、オーサリングツールを活用することです。HTMLの作成に特化したオーサリングツールは、要素名や属性名を補完するなど、HTMLの入力を支援する機能を備えています。そのような機能を活用すれば、タイプミスによるエラーを減らすことができるでしょう。

### 文法チェックを行う
オーサリングツールの入力支援に頼っても、ミスを完全にゼロにすることはできません。HTMLを書いた際は、ツールを使って文法をチェックしましょう。チェックツールとして最も有名なのはW3CのThe W3C Markup Validation Service（参考1）ですが、他にもさまざまなツールがあります。オーサリングツールにチェックツールが組み込まれていることもありますので、確認してみると良いでしょう（図1）。なお、古いチェックツールはHTML5に対応していないこともあるため、選定時には注意しましょう。


図1：オーサリングツールの文法チェックの例
HTMLを書きながら随時チェックすることができるため、文法ミスにすぐ気づくことができる。


重要なのは、チェックを確実に実施することです。どのタイミングでチェックするのか明確になっていないと、チェックが漏れることがあります。タイミングを明確にし、確実にチェックを実施しましょう。

オーサリングツールの設定やマクロなどの機能で、定期的にチェックしながら作業したり、保存が行われたタイミングで自動的にチェックを行える場合があります。ソフトウェア開発では、CI（継続的インテグレーション）という手法を採用して、チェックを通らないと公開できないようにすることもあります。このような手法を採用できれば、チェックを確実に行うことができるはずです。

## コラム 「ネ申Excel」問題
HTML5の仕様では、文法エラーの際の処理が明確に決まっていますので、文法ミスでブラウザごとに差異が出ることはほとんどありません。そのため、文法ミスをあまり重視しない人もいます。しかし、Webを利用するのはブラウザベンダーが作ったブラウザだけではありません。たとえば、東日本大震災の際には、公的機関がWeb上でさまざまなデータを公開し、多くの個人や組織がそのデータを活用しました。

この際、やはりデータのマシンリーダビリティが問題になりました。特に、放射線量などのデータが機械処理困難な形のExcelデータで提供されていたことが批判され、奥村晴彦氏による「ネ申Excel」問題の論文では、以下のような問題が指摘されています。

* 数値が文字列として（文字列と一緒に同じセルに）入力されると、数値として処理できなかったり、誤記が含まれたりする
* セル結合を多用した表は機械処理に向かない
* 背景色やフォントに意味を持たせた表はマシンリーダビリティが劣る

これもれっきとしたアクセシビリティの問題です。1章でも述べたように、マシンリーダビリティの高い形でデータを提供することは、アクセシビリティの向上につながるだけでなく、データの再利用性の向上にもつながり、Webの可能性を大きく広げるのです。

「ネ申Excel」問題（奥村晴彦著、2013年7月12日発表）
http://oku.edu.mie-u.ac.jp/~okumura/SSS2013.pdf



参考1 The W3C Markup Validation Service
http://validator.w3.org/
